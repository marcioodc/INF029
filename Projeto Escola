#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
#define TAMALUNO 2
#define TAMPROFESSOR 2
#define TAMDISCIPLINA 2

// criar modulo
//aluno
//professor
//disciplina

typedef struct aluno {
    int matricula;
    char nome[50];
    char sexo;
    int dia, mes, ano; //data nascimento 
    char cpf[15];
    int ativo;
} aluno;

typedef struct professor {
    int matricula;
    char nome[50];
    char sexo;
    int dia, mes, ano; //data nascimento
    char cpf[15];
    int ativo;
} professor;

typedef struct disciplina {
    char nome[50];
    char codigo[10];
    int semestre;
    int disprof;
    int ativo;
    int qtdvagas;
    int alunomatriculado[TAMALUNO]; 

} disciplina;
//valindando a data
int validaData(int dia, int mes, int ano) {
    if (ano < 1 || mes < 1 || mes > 12 || dia < 1) return 0;

    int diasMes[] = {0, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31};
    if (mes == 2 && ((ano % 4 == 0 && ano % 100 != 0) || ano % 400 == 0)) {
        diasMes[2] = 29; // fevereiro em ano bissexto
    }

    return (dia <= diasMes[mes]) ? 1 : 0;
}
//Descobrindo a posição do aluno
int posaluno(aluno a[], int qtdaluno, int matricula){
    int i;
    for(i = 0; i < qtdaluno; i++){
        if(a[i].matricula == matricula){
            return i;
        }
    }
    return -1;
}

int posdisc(disciplina d[], int qtdisciplina, char codigo[]){
    int i;
    for(i=0; i<qtdisciplina; i++){
        if(strcmp(d[i].codigo, codigo) == 0){
            return i;
        }
    }
    return -1;
}

int posprof(professor p[], int qtdprof, int matricula){
    int i;
    for(i=0; i<qtdprof; i++){
        if(p[i].matricula == matricula){
            return i;
        }
    }
    return -1;
}
void removerdedisciplina(disciplina d[], int qtdisciplina, int matricula, char tipo) {
    // a = aluno, p = professor
    for(int i=0; i<qtdisciplina; i++){
        if(tipo == 'a') {
            for(int j=0; j<TAMALUNO; j++) {
                if(d[i].alunomatriculado[j] == matricula) {
                    d[i].alunomatriculado[j] = 0;
                }
            }
        } else if(tipo == 'p') {
            if(d[i].disprof == matricula){
                d[i].disprof = 0;
            }
        }
    }
}

int Acomparadata(aluno i, aluno j) {
    return (i.ano > j.ano) ||
           (i.ano == j.ano && i.mes > j.mes) ||
           (i.ano == j.ano && i.mes == j.mes && i.dia > j.dia);
}

int Pcomparadata(professor i, professor j) {
    return (i.ano > j.ano) ||
           (i.ano == j.ano && i.mes > j.mes) ||
           (i.ano == j.ano && i.mes == j.mes && i.dia > j.dia);
}
void meses(aluno a[], int qtdaluno, professor p[], int qtdprof, int mes){
    int cont = 0;
    for(int i=0; i<qtdaluno; i++){
        if(a[i].ativo && a[i].mes == mes){
            printf("Aluno: %s\n", a[i].nome);
            cont++;
        }
    }
    for(int j=0; j<qtdprof; j++){
        if(p[j].ativo && p[j].mes == mes){
            printf("Professor: %s\n", p[j].nome);
            cont++;
        }
    }
    if(cont == 0){
        printf("\nNão há aniversariantes neste mês!\n");
    }
}

int main(void){
    aluno a[TAMALUNO];
    professor p[TAMPROFESSOR];
    disciplina d[TAMDISCIPLINA];
    int opcao;
    int sair = 0;
    int qtdaluno = 0;
    int qtdprof = 0;
    int qtdisciplina = 0;
    
    while(!sair){
        //Menu principal
        printf("\n---Projeto Escola---\n");
        printf("Escolha uma opção:\n");
        printf("1- Aluno\n");
        printf("2- Professor\n");
        printf("3- Disciplina\n");
        printf("4- Relatórios\n");
        printf("5- Finalizar programa\n");
        scanf("%d", &opcao);
        switch(opcao){
            case 5: {
                sair = 1;
                break;
            }
            case 1:{
                int sairaluno = 0;
                int opcaoaluno;
                
                while(!sairaluno){
                    //Menu aluno
                    printf("\n---Aluno---\n");
                    printf("1- Cadastrar aluno\n");
                    printf("2- Listar aluno\n");
                    printf("3- Atualizar aluno\n");
                    printf("4- Excluir aluno\n");
                    printf("5- Voltar ao menu principal\n");
                    scanf("%d", &opcaoaluno);
                    switch(opcaoaluno){
                        case 5:{
                            sairaluno = 1;
                            break;
                        }
                        case 1:{
                            //cadastrar aluno
                            int matricula;
                            if(qtdaluno == TAMALUNO){
                                printf("A lista está cheia\n");
                            }else{
                                printf("Cadastrando aluno\n");
                                printf("--Informações do aluno--\n");
                                printf("Matricula: ");
                                scanf("%d", &matricula);
                                if(posaluno(a, qtdaluno, matricula) != -1){
                                    printf("\nJá existe aluno com essa matrícula!\n");
                                    break;
                                }
                                if(matricula < 0){
                                    printf("\nMatricula inválida\n");
                                    break;
                                }else{
                                    a[qtdaluno].matricula = matricula;
                                    //Nome do aluno
                                    getchar();
                                    printf("Nome: ");
                                    fgets(a[qtdaluno].nome, sizeof(a[qtdaluno].nome), stdin);
                                    a[qtdaluno].nome[strcspn(a[qtdaluno].nome, "\n")] = '\0';
                                    //Sexo do aluno
                                    printf("Sexo: 'F' ou 'M': ");
                                    scanf(" %c", &a[qtdaluno].sexo);
                                    a[qtdaluno].sexo = toupper(a[qtdaluno].sexo);
                                    if(a[qtdaluno].sexo != 'F' && a[qtdaluno].sexo != 'M'){
                                        printf("\nNão entendi! Use apenas 'M' ou 'F'\n");
                                        break;
                                    }
                                    //CPF do aluno
                                    printf("CPF: ");
                                    scanf(" %14s", a[qtdaluno].cpf);
                                    
                                    //Data de nascimento do aluno
                                    int res;
                                    printf("Data de nascimento 'dd/mm/aaaa': ");
                                    scanf("%d/%d/%d", &a[qtdaluno].dia, &a[qtdaluno].mes, &a[qtdaluno].ano);
                                    res= validaData(a[qtdaluno].dia, a[qtdaluno].mes, a[qtdaluno].ano);
                                    if(res == 0){
                                        printf("Data inválida!\n");
                                        break;
                                    }
                                    
                                    a[qtdaluno].ativo = 1;
                                    qtdaluno++;
                                 
                                printf("---Cadastro realizado com sucesso---\n");
                                }
                            }
                        }break;
                        case 2:{
                            //listar alunos
                            if(qtdaluno == 0){
                                printf("A lista está vazia\n");
                            }else{
                                printf("Listando os alunos\n");
                                for(int i=0; i < qtdaluno; i++){
                                    if(a[i].ativo == 1){
                                        printf("--Aluno %d--\n ", i+ 1);
                                        printf("Matricula: %d  |  Nome: %s\n", a[i].matricula, a[i].nome);
                                        printf("Sexo: %c  |  Data de Nascimento: %d/%d/%d\n", a[i].sexo, a[i].dia, a[i].mes, a[i].ano);
                                        printf("CPF: %s\n", a[i].cpf);
                                        
                                    }
                                }
                            }
                            
                        }break;
                        case 3:{
                            //atualizar alunos
                            int atualizarM;
                            if(qtdaluno == 0){
                                printf("\nNenhum aluno cadastrado\n");
                                break;
                            }
                            printf("Informe a matricula do aluno que você deseja atualizar: ");
                            scanf("%d", &atualizarM);
                            int posicao = posaluno(a, qtdaluno, atualizarM);
                            
                            if(posicao == -1){
                                printf("Aluno não encontrado!\n");
                            }else{
                                aluno novoaluno;
                                getchar();
                                //Nome do novo aluno
                                printf("\nNome: ");
                                fgets(novoaluno.nome, sizeof(novoaluno.nome), stdin);
                                novoaluno.nome[strcspn(novoaluno.nome, "\n")] = '\0';
                                
                                //Sexo do novo aluno
                                printf("Sexo: 'F' ou 'M': ");
                                scanf(" %c", &novoaluno.sexo);
                                novoaluno.sexo = toupper(novoaluno.sexo);
                                if(novoaluno.sexo != 'F' && novoaluno.sexo != 'M'){
                                    printf("Não entendi! Use apenas 'M' ou 'F'\n");
                                    break;
                                }
                                //CPF do novo aluno 
                                printf("CPF: ");
                                scanf(" %14s", novoaluno.cpf);
                                  
                                //Data de nascimento do novo aluno
                                int res;
                                printf("Data de nascimento: 'dd/mm/aaaa': ");
                                scanf("%d/%d/%d", &novoaluno.dia, &novoaluno.mes, &novoaluno.ano);
                                res= validaData(novoaluno.dia, novoaluno.mes, novoaluno.ano);
                                if(res == 0){
                                    printf("Data inválida!\n");
                                    break;
                                }
                                novoaluno.ativo = a[posicao].ativo;
                                novoaluno.matricula = a[posicao].matricula;
                                a[posicao] = novoaluno;
                                printf("\nCadastro atualizado com sucesso\n");
                            }
                            
                        }break;
                        case 4:{
                            //excluir aluno
                            int excluir;
                            if(qtdaluno == 0){
                                printf("\nNenhum aluno cadastrado\n");
                                break;
                            }
                            printf("Digite a matricula do aluno que deseja excluir: ");
                            scanf("%d", &excluir);
                            int posexcluir = posaluno(a, qtdaluno, excluir);
                            if(posexcluir == -1){
                                printf("Matricula não encontrada\n");
                            }else{
                                removerdedisciplina(d, qtdisciplina, a[posexcluir].matricula, 'a');
                                for(int i = posexcluir; i < qtdaluno - 1; i++){
                                    a[i] = a[i+1];
                                }
                                qtdaluno--;
                                a[qtdaluno].ativo = 0;
                                printf("--Aluno excluído com sucesso--\n");
                            }
                            
                        }break;
                        default:{
                            printf("\nOpção inválida!\n");
                        }break;
                    }
                    
                }
            }break;
            case 2:{
                int sairprofessor = 0;
                int opcaoprofessor;
                
                while(!sairprofessor){
                    //Menu professor
                    printf("\n---Professor---\n");
                    printf("1- Cadastrar professor\n");
                    printf("2- Listar professor\n");
                    printf("3- Atualizar professor\n");
                    printf("4- Excluir professor\n");
                    printf("5- Voltar ao menu principal\n");
                    scanf("%d", &opcaoprofessor);
                    switch(opcaoprofessor){
                        case 5:{
                            sairprofessor = 1;
                            printf("\n--Voltando ao menu principal--\n");
                        }break;
                        case 1:{
                            //cadastrar professor
                            int matricula;
                            if(qtdprof == TAMPROFESSOR){
                                printf("A lista está cheia\n");
                                
                            }else{
                                printf("Cadastrando professor\n");
                                printf("--Informações do professor--\n");
                                printf("Matricula: ");
                                scanf("%d", &matricula);
                                if(posprof(p, qtdprof, matricula) != -1){
                                    printf("\nJá existe professor com essa matrícula!\n");
                                    break;
                                }
                                if(matricula < 0){
                                    printf("\nMatricula inválida\n");
                                    break;
                                }else{
                                    p[qtdprof].matricula = matricula;
                                    //Nome do professor
                                    getchar();
                                    printf("Nome: ");
                                    fgets(p[qtdprof].nome, sizeof(p[qtdprof].nome), stdin);
                                    p[qtdprof].nome[strcspn(p[qtdprof].nome, "\n")] = '\0';
                                    //Sexo do professor
                                    printf("Sexo: 'F' ou 'M': ");
                                    scanf(" %c", &p[qtdprof].sexo);
                                    p[qtdprof].sexo = toupper(p[qtdprof].sexo);
                                    if(p[qtdprof].sexo != 'F' && p[qtdprof].sexo != 'M'){
                                        printf("\nNão entendi! Use apenas 'M' ou 'F'\n");
                                        break;
                                    }
                                    //CPF do professor
                                    printf("CPF: ");
                                    scanf(" %14s", p[qtdprof].cpf);
                                    
                                    //Data de nascimento do professor
                                    int res;
                                    printf("Data de nascimento 'dd/mm/aaaa': ");
                                    scanf("%d/%d/%d", &p[qtdprof].dia, &p[qtdprof].mes, &p[qtdprof].ano);
                                    res= validaData(p[qtdprof].dia, p[qtdprof].mes, p[qtdprof].ano);
                                    if(res == 0){
                                        printf("Data inválida!\n");
                                        break;
                                    }
                                    
                                    p[qtdprof].ativo = 1;
                                    qtdprof++;
                                 
                                    printf("---Cadastro realizado com sucesso---\n");
                                }
                                    
                            }
                            
                        }break;
                        case 2:{
                            //listar professores
                            if(qtdprof == 0){
                                printf("A lista está vazia\n");
                            }else{
                                printf("Listando os professores\n");
                                for(int i=0; i < qtdprof; i++){
                                    if(p[i].ativo == 1){
                                        printf("--Professor %d--\n ", i+ 1);
                                        printf("Matricula: %d  |  Nome: %s\n", p[i].matricula, p[i].nome);
                                        printf("Sexo: %c  |  Data de Nascimento: %d/%d/%d\n", p[i].sexo, p[i].dia, p[i].mes, p[i].ano);
                                        printf("CPF: %s\n", p[i].cpf);
                                        
                                    }
                                }
                            }
                            
                        }break;
                        case 3:{
                            //atualizar professor
                            int atualizarM;
                            if(qtdprof == 0){
                                printf("\nNenhum professor cadastrado\n");
                                break;
                            }
                            printf("Informe a matricula do professor que você deseja atualizar: ");
                            scanf("%d", &atualizarM);
                            int posicao = posprof(p, qtdprof, atualizarM);
                            
                            if(posicao == -1){
                                printf("\nProfessor não encontrado!\n");
                            }else{
                                professor novoprof;
                                getchar();
                                //Nome do novo professor
                                printf("\nNome: ");
                                fgets(novoprof.nome, sizeof(novoprof.nome), stdin);
                                novoprof.nome[strcspn(novoprof.nome, "\n")] = '\0';
                                
                                //Sexo do novo professor
                                printf("Sexo: 'F' ou 'M': ");
                                scanf(" %c", &novoprof.sexo);
                                novoprof.sexo = toupper(novoprof.sexo);
                                if(novoprof.sexo != 'F' && novoprof.sexo != 'M'){
                                    printf("Não entendi! Use apenas 'M' ou 'F'\n");
                                    break;
                                }
                                //CPF do novo professor 
                                printf("CPF: ");
                                scanf(" %14s", novoprof.cpf);
                                    
                                //Data de nascimento do novo professor
                                int res;
                                printf("Data de nascimento: 'dd/mm/aaaa': ");
                                scanf("%d/%d/%d", &novoprof.dia, &novoprof.mes, &novoprof.ano);
                                res= validaData(novoprof.dia, novoprof.mes, novoprof.ano);
                                if(res == 0){
                                    printf("Data inválida!\n");
                                    break;
                                }
                                novoprof.ativo = p[posicao].ativo;
                                novoprof.matricula = p[posicao].matricula;
                                p[posicao] = novoprof;
                                printf("\nCadastro atualizado com sucesso\n");
                            }
                            
                        }break;
                        case 4:{
                            //excluir professor
                            int excluir;
                            if(qtdprof == 0){
                                printf("\nNenhum professor cadastrado\n");
                                break;
                            }
                            printf("Digite a matricula do professor que deseja excluir: ");
                            scanf("%d", &excluir);
                            int posexcluir = posprof(p, qtdprof, excluir);
                            if(posexcluir == -1){
                                printf("Matricula não encontrada\n");
                            }else{
                                removerdedisciplina(d, qtdisciplina, p[posexcluir].matricula, 'p');
                                for(int i = posexcluir; i < qtdprof - 1; i++){
                                    p[i] = p[i+1];
                                }
                                qtdprof--;
                                p[qtdprof].ativo = 0;
                                printf("--Professor excluído com sucesso--\n");
                            }
                        }break;
                        default:{
                            printf("\nOpção inválida!\n");
                        }
                    }
                    
                }
                
            }break;
            case 3:{
                int sairdisciplina = 0;
                int opcaodisciplina;
                while(!sairdisciplina){
                    printf("\n---Disciplina---\n");
                    printf("1- Cadastrar disciplina\n");
                    printf("2- Listar disciplinas\n");
                    printf("3- Atualizar disciplina\n");
                    printf("4- Excluir disciplina\n");
                    printf("5- Inserir aluno na disciplina\n");
                    printf("6- Excluir aluno da disciplina\n");
                    printf("7- Voltar ao menu principal\n");
                    scanf("%d", &opcaodisciplina);
                    switch(opcaodisciplina){
                        case 7:{
                            printf("\n--Voltando ao menu principal--\n");
                            sairdisciplina = 1;
                        }break;
                        case 1:{
                            //cadastrar disciplina
                            for(int j=0; j<TAMALUNO; j++){
                                d[qtdisciplina].alunomatriculado[j] = 0;
                            }
                            char codigo[10];
                            if(qtdisciplina == TAMDISCIPLINA){
                                printf("A lista está cheia\n");
                                break;
                            }else{
                                printf("Cadastrando disciplina\n");
                                printf("--Informações da disciplina--\n");
                                printf("Código: ");
                                scanf("%9s", codigo);
                                if(posdisc(d, qtdisciplina, codigo) != -1){
                                    printf("Já existe disciplina com este código!\n");
                                    break;
                                }
                                strcpy(d[qtdisciplina].codigo, codigo);
                                    //Nome da disciplina
                                printf("Nome: ");
                                getchar();
                                fgets(d[qtdisciplina].nome, sizeof(d[qtdisciplina].nome), stdin);
                                d[qtdisciplina].nome[strcspn(d[qtdisciplina].nome, "\n")] = '\0';
                                    
                                    //Semestre
                                printf("Semestre: ");
                                scanf("%d", &d[qtdisciplina].semestre);
                                if(d[qtdisciplina].semestre < 1){
                                    printf("\nSemestre inválido. Digite um valor maior que zero\n");
                                    break;
                                }
                                //Quantidade de vagas
                                printf("Quantidade de vagas: ");
                                scanf("%d", &d[qtdisciplina.qtdvagas]);
                                if(d[qtdisciplina].qtdvagas < 1){
                                    printf("\nValor inválido! Digite um valor maior que 0!\n");
                                    break;
                                }
                                
                                //Matricula do prof responsável
                                    
                                printf("Matrícula do professor: ");
                                scanf("%d", &d[qtdisciplina].disprof);
                                //Verifica se ha professor com a matricula
                                int existe = -1;
                                for(int j=0; j<qtdprof; j++){
                                    if(d[qtdisciplina].disprof == p[j].matricula && p[j].ativo == 1){
                                        existe = 1;
                                        break;
                                    }
                                }
                                if(existe == -1){
                                    printf("\nNão há professor cadastrado com a matrícula informada\n");
                                    break;
                                }else{
                                    printf("\nCadastro realizado com sucesso\n");
                                } 
                                d[qtdisciplina].ativo = 1;
                                qtdisciplina++;
                                
                            }
                                
                        }break;
                        case 2:{
                            if(qtdisciplina == 0){
                                printf("A lista está vazia\n");
                            }else{
                                printf("Listando as disciplinas\n");
                                for(int i=0; i < qtdisciplina; i++){
                                    if(d[i].ativo == 1){
                                        printf("--Disciplina %d--\n ", i+ 1);
                                        printf("Código: %s  |  Nome: %s\n", d[i].codigo, d[i].nome);
                                        printf("Semestre: %d\n", d[i].semestre);
                                        printf("Professor responsável: %d\n", d[i].disprof);
                                    }
                                }
                            }
                            
                        }break;
                        case 3:{
                            char atualizarcod[10];
                            if(qtdisciplina == 0){
                                printf("\nNenhuma disciplina cadastrada\n");
                                break;
                            }
                            printf("Informe o código da disciplina que você deseja atualizar: ");
                            scanf("%9s", atualizarcod);
                            int posicao = posdisc(d, qtdisciplina, atualizarcod);
                            
                            if(posicao == -1){
                                printf("\nDisciplina não encontrado!\n");
                            }else{
                                disciplina novadisc = d[posicao];
                                strcpy(novadisc.codigo, d[posicao].codigo);
                                //Nome da disciplina
                                printf("Nome: ");
                                getchar();
                                fgets(novadisc.nome, sizeof(novadisc.nome), stdin);
                                novadisc.nome[strcspn(novadisc.nome, "\n")] = '\0';
                                
                                //Semestre
                                
                                printf("Semestre: ");
                                scanf("%d", &novadisc.semestre);
                                if(novadisc.semestre < 1){
                                    printf("\nSemestre inválido. Digite um valor maior que zero\n");
                                    break;
                                }
                                //Quantidade de vagas
                                printf("Quantidade de vagas: ");
                                scanf("%d", &d[qtdisciplina.qtdvagas]);
                                if(d[qtdisciplina].qtdvagas < 1){
                                    printf("\nValor inválido! Digite um valor maior que 0!\n");
                                    break;
                                }
                                
                                //Matricula do prof responsável 
                                
                                printf("Matrícula do professor: ");
                                scanf("%d", &novadisc.disprof);
                                //Verifica se ha professor com a matricula
                                int existe = 0;
                                for(int j=0; j<qtdprof; j++){
                                    if(novadisc.disprof == p[j].matricula){
                                        existe = 1;
                                        break;
                                    }
                                }
                                if(!existe){
                                    printf("\nNão há professor cadastrado com a matrícula informada\n");
                                    break;
                                }else{
                                    printf("\nCadastro realizado com sucesso\n");
                                }
                                novadisc.ativo = d[posicao].ativo;
                                d[posicao] = novadisc;
                            }
                            
                        }break;
                        case 4:{
                            char excluir[10];
                            if(qtdisciplina == 0){
                                printf("\nNenhuma disciplina cadastrada\n");
                                break;
                            }
                            printf("Digite o código da disciplina que deseja excluir: ");
                            scanf("%9s", excluir);
                            int posexcluir = posdisc(d, qtdisciplina, excluir);
                            if(posexcluir == -1){
                                printf("Código não encontrado\n");
                                
                            }else{
                                for(int i = posexcluir; i < qtdisciplina - 1; i++){
                                    d[i] = d[i+1];
                                }
                                qtdisciplina--;
                                printf("--Disciplina excluída com sucesso--\n");
                            }
                            
                        }break;
                        case 5:{
                            int a_matricula;
                            char codisc[10];
                            printf("\n--Atribuindo aluno à disciplina--\n");
                            printf("Informe o código da disciplina: \n");
                            scanf("%9s", codisc);
                            int poscod = posdisc(d, qtdisciplina, codisc);
                            if(poscod == -1){
                                printf("\nCódigo da disciplina não localizado\n");
                                break;
                            }
                            printf("Informe a matrícula do aluno: \n");
                            scanf("%d", &a_matricula);
                            int posmat = posaluno(a, qtdaluno, a_matricula);
                            if(posmat == -1){
                                printf("\nMatrícula do aluno não localizada\n");
                                break;
                            }
                            for(int j=0; j<TAMALUNO; j++){
                                if(d[poscod].alunomatriculado[j] == a_matricula){
                                    printf("\nAluno já está matriculado nesta disciplina\n");
                                    break;
                                }
                            }
                            int matriculado = 0;
                            for(int j=0; j<TAMALUNO; j++){
                                if(d[poscod].alunomatriculado[j]==0){
                                    d[poscod].alunomatriculado[j] = a_matricula;
                                    matriculado++;
                                    break;
                                }
                            }
                            if(matriculado){
                                printf("\nAluno %s matriculado na disciplina %s com sucesso\n", a[posmat].nome, d[poscod].codigo);
                            }else{
                                printf("\nNão há vagas nesta disciplina\n");
                            }
                            
                        }break;
                        case 6:{
                            int a_matricula;
                            char codisc[10];
                            printf("\n--Excluíndo aluno da disciplina--\n");
                            printf("Informe o código da disciplina: \n");
                            scanf("%9s", codisc);
                            int poscod = posdisc(d, qtdisciplina, codisc);
                            if(poscod == -1){
                                printf("\nCódigo da disciplina não localizado\n");
                                break;
                            }
                            printf("Informe a matrícula do aluno: \n");
                            scanf("%d", &a_matricula);
                            int posmat = posaluno(a, qtdaluno, a_matricula);
                            if(posmat == -1){
                                printf("\nMatrícula do aluno não localizada\n");
                                break;
                            }          
                            int excluiralunodisc = 0;
                            for(int j=0; j<TAMALUNO; j++){
                                if(d[poscod].alunomatriculado[j]== a_matricula){
                                    d[poscod].alunomatriculado[j] = 0;
                                    excluiralunodisc = 1;
                                    break;
                                }
                            }
                            if(excluiralunodisc){
                            printf("\nAluno %s excluído da disciplina %s com sucesso\n", a[posmat].nome, d[poscod].codigo);
                            }else{
                                printf("\nAluno não está matriículado nesta disciplina\n");
                            }

                        }break;
                        default:{
                            printf("\nOpção inválida!\n");
                        }
                    }
                }
            }break;
            case 4:{
                int opcaorelatorio;
                int sairrelatorio = 0;
                while(!sairrelatorio){
                    printf("\n---Relatórios---\n");
                    printf("1- Voltar ao menu principal\n");
                    printf("2- Listar alunos\n");
                    printf("3- Listar professor\n");
                    printf("4- Listar disciplina\n");
                    printf("5- Dados da disciplina\n");
                    printf("6- Alunos ordenados por sexo\n");
                    printf("7- Alunos ordenados por nome\n");
                    printf("8- Mais opções\n");
                    printf("9- Alunos ordenados por data de nascimento\n");
                    printf("10- Professores ordenados por sexo\n");
                    printf("11- Professores ordenados por nome\n");
                    printf("12- Professores ordenados por data de nascimento\n");
                    printf("13- Aniversariantes do mês\n");
                    printf("14- Pesquisa por nome\n");
                    printf("15- Alunos matriculados em menos de 3 disciplinas\n");
                    printf("16- Lista de disciplinas com mais de 40 vagas\n");
                    scanf("%d", &opcaorelatorio);
                    switch(opcaorelatorio){
                        case 1:{
                            printf("\n---Voltando ao menu principal---\n");
                            sairrelatorio = 1;
                        }break;
                        case 2: {
                            //listando os alunos
                            if(qtdaluno == 0){
                                printf("\nNão há alunos cadastrados!\n");
                            }else{
                                printf("\nListando os alunos:\n");
                                for(int i=0; i < qtdaluno; i++){
                                    if(a[i].ativo == 1){
                                        printf("%d - %s (%d)\n", i+1, a[i].nome, a[i].matricula);
                                }
                            }
                        }break;
                        case 3:{
                            //listando professores
                            if(qtdprof == 0){
                                printf("Não há professores cadastrados!\n");
                            }else{
                                printf("\nListando os professores:");
                                printf("\nN° | Nome | Matrícula\n");
                                for(int i=0; i < qtdprof; i++){
                                    if(p[i].ativo == 1){
                                        printf("%d |  %s  | %d\n", i+1, p[i].nome, p[i].matricula);
                                    }
                                }
                            }
                        }break;
                        case 4:{
                        //Listando disciplina
                            if(qtdisciplina == 0){
                                printf("\nNão há disciplinas cadastradas!\n");
                            }else{
                                printf("\nN° | Disciplina | Código\n");
                                for(int i=0; i < qtdisciplina; i++){
                                    if(d[i].ativo == 1){
                                        printf("%d |  %s  | %s\n", i+1, d[i].nome, d[i].codigo);
                                        int posprofessor = posprof(p, qtdprof, d[i].disprof);
                                        if(posprofessor != -1){
                                            printf("Semestre: %d | Prof° responsável: %s\n", d[i].semestre, p[posprofessor].nome);
                                        }
                                    }
                                }
                            }
                        }break;
                        case 5:{
                            // Listar disciplina com alunos matriculados
                            if(qtdisciplina == 0){
                                printf("\nNão há disciplina cadastrada!\n");
                                break;
                            }else{
                                for(int i=0; i<qtdisciplina; i++){
                                    if(d[i].ativo == 1){
                                        printf("\nDisciplina: %s | Código: %s ", d[i].nome, d[i].codigo);
                                        int posprofessor = posprof(p, qtdprof, d[i].disprof);
                                        if(posprofessor != -1){
                                            printf("Professor responsável: %s\n", p[posprofessor].nome);
                                        }
                                        printf("Alunos matriculados:\n");
                                        int temaluno = 0;
                                        for(int j=0; j<TAMALUNO; j++){
                                            if(d[i].alunomatriculado[j] != 0){
                                                int posal = posaluno(a, qtdaluno, d[i].alunomatriculado[j]);
                                                if(posal != -1){
                                                    printf("- %s (Matrícula: %d)\n", a[posal].nome, a[posal].matricula);
                                                    temaluno = 1;
                                                }
                                            }
                                        }
                                        if(!temaluno){
                                            printf("Nenhum aluno matriculado nesta disciplina\n\n");
                                        }
                                    }
                                }
                            }
                        } break;
                        case 6:{//listando por sexo
                            if(qtdaluno == 0){
                                printf("\nNão há alunos cadastrados!\n");
                            }else{
                                printf("\n××Masculino××\n");
                                for(int i=0; i<qtdaluno; i++){
                                    if(a[i].sexo == 'M' || a[i].sexo == 'm'){
                                        printf("%s | %c\n", a[i].nome, a[i].sexo);
                                    }
                                }
                                printf("\n××Feminino××\n");
                                for(int j=0; j<qtdaluno; j++){
                                    if(a[j].sexo == 'F' || a[j].sexo == 'f'){
                                        printf("%s | %c\n", a[j].nome, a[j].sexo);
                                    }
                                }
                            }
                        }break;
                        case 7:{//ordenando os alunos
                            for(int i=0; i<qtdaluno-1; i++){
                                for(int j=i+1; j<qtdaluno; j++){
                                    if(strcmp(a[i].nome, a[j].nome) > 0){
                                        aluno temp = a[i];
                                        a[i] = a[j];
                                        a[j] = temp;
                                    }
                                }
                            }
                            printf("\n>>>Alunos<<<\n");
                            for(int i=0; i<qtdaluno; i++){
                                printf("%s - %d", a[i].nome, a[i].matricula);
                            }
                        }break;
                        case 8:{//ordenando alunos por data de nascimento
                            for(int i=0; i<qtdaluno-1; i++){
                                for(int j=i+1; j<qtdaluno; j++){
                                    if(Acomparadata(a[i], a[j])){
                                        aluno temp = a[i];
                                        a[i] = a[j];
                                        a[j] = temp;
                                    }
                                }
                            }
                            for(int i=0; i<qtdaluno; i++){
                                printf("%02d/%02d/%04d  -  %s\n", a[i].dia, a[i].mes, a[i].ano, a[i].nome);
                            }
                        }break;
                        case 9:{//listando professores por sexo
                            if(qtdprof == 0){
                                printf("\nNão há professores cadastrados!\n");
                            }else{
                                printf("\n××Masculino××\n");
                                for(int i=0; i<qtdprof; i++){
                                    if(p[i].sexo == 'M' || p[i].sexo == 'm'){
                                        printf("%s | %c\n", p[i].nome, p[i].sexo);
                                    }
                                }
                                printf("\n××Feminino××\n");
                                for(int j=0; j<qtdprof; j++){
                                    if(p[j].sexo == 'F' || p[j].sexo == 'f'){
                                        printf("%s | %c\n", p[j].nome, p[j].sexo);
                                    }
                                }
                            }
                        }break;
                        case 10:{//listando professores por nome
                            for(int i=0; i<qtdprof-1; i++){
                                for(int j=i+1; j<qtdprof; j++){
                                    if(strcmp(p[i].nome, p[j].nome) > 0){
                                        professor temp = p[i];
                                        p[i] = p[j];
                                        p[j] = temp;
                                    }
                                }
                            }
                            printf("\n>>>Professores<<<\n");
                            for(int i=0; i<qtdprof; i++){
                                printf("%s - %d\n", p[i].nome, p[i].matricula);
                            }
                        }break;
                        case 11:{
                            for(int i=0; i<qtdprof-1; i++){
                                for(int j=i+1; j<qtdprof; j++){
                                    if(Pcomparadata(p[i], p[j])){
                                        professor temp = p[i];
                                        p[i] = p[j];
                                        p[j] = temp;
                                    }
                                }
                            }
                            for(int i=0; i<qtdprof; i++){
                                printf("%02d/%02d/%04d  -  %s\n", p[i].dia, p[i].mes, p[i].ano, p[i].nome);
                            }
                        }break;
                        case 12:{//aniversariantes do mes
                            int mes = -1;
                            while(mes != 0){
                            printf("Selecione o mês: \n");
                            printf("0- Voltar ao menu Relatórios\n");
                            printf("1- Janeiro   | 7- Julho\n2- Fevereiro | 8- Agosto\n3- Março     | 9- Setembro\n");
                            printf("4- Abril     | 10- Outubro\n5- Maio      | 11- Novembro\n6- Junho     | 12- Dezembro\n");
                            scanf("%d", &mes);
                            if(mes >= 1 && mes <= 12){
                                meses(a, qtdaluno, p, qtdprof, mes);
                            }else{
                                printf("\nMês inválido!\n");
                            }
                        }break;
                        case 13:{//imprimir os alunos que estão matriculados em menos de 3 disciplinas
                            printf("\nAlunos matriculados em menos de 3 disciplinas: \n");
                            for(int i=0; i<qtdaluno; i++){
                                if(a[i].ativo == 1){
                                    int icont = 0;
                                    for(int j=0; j<qtdisciplina; j++){
                                        for(int k=0; k<TAMALUNO; k++){
                                            if(a[j].alunomatriculado[k] == a[i].matricula){
                                               icont++;
                                            }
                                        }
                                    }
                                    if(icont < 3){
                                        printf("Nome: %s | Matrícula: %d", a[i].nome, a[i].matricula);
                                    }
                                }
                            }
                        }break;
                        case 14:{//disciplinas cujas vagas são superiores a 40
                            int encontrou = 0;
                            printf("\nDisciplinas com mais de 40 vagas:\n");
                            for(int i = 0; i < qtdisciplina; i++){
                                if(d[i].ativo && d[i].qtdvagas > 40){
                                    printf("N°%d | %s | Código: %s | Vagas: %d\n", i+1, d[i].nome, d[i].codigo, d[i].qtdvagas);
                                    int posprofessor = posprof(p, qtdprof, d[i].disprof);
                                    if(posprofessor != -1){
                                        printf("Professor responsável: %s\n", p[posprofessor].nome);
                                    }
                                    encontrou = 1;
                                }
                            }
                            if(!encontrou){
                                printf("\nNão há disciplinas com mais de 40 vagas!\n");
                            }
                        }break;
                        default:{
                            printf("\nOpção inválida!\n");
                        }break;
                    }
                }break;
            }
            default:{
                printf("\nOpção inválida!\n");
            }break;
        }
        
    }
    return 0;
}
